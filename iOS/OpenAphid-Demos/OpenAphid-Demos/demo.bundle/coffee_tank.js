// Generated by CoffeeScript 1.4.0
var moduletank;

moduletank = {};

moduletank.maxTankCount = 1000;

moduletank.Tank = (function() {

  function Tank(texture) {
    var winSize,
      _this = this;
    this.sprite = new aphid.g2d.Sprite(texture);
    this.vx = Math.random() > 0.5 ? 0.1 : -0.1;
    this.vy = Math.random() > 0.5 ? 0.1 : -0.1;
    winSize = aphid.g2d.director.winSize;
    this.sprite.position = new aphid.core.Point(Math.random() * winSize.width, Math.random() * winSize.height);
    this.sprite.scheduleUpdate();
    this.sprite.onframeupdate = function(target, interval) {
      var p, size;
      p = _this.sprite.position;
      p.x += interval * 1000 * _this.vx;
      p.y += interval * 1000 * _this.vy;
      size = aphid.g2d.director.winSize;
      if (p.x < 0) {
        p.x = 0;
        _this.vx = -_this.vx;
      } else if (p.x > size.width) {
        p.x = size.width;
        _this.vx = -_this.vx;
      }
      if (p.y < 0) {
        p.y = 0;
        _this.vy = -_this.vy;
      } else if (p.y > size.height) {
        p.y = size.height;
        _this.vy = -_this.vy;
      }
      return _this.sprite.position = p;
    };
  }

  Tank.prototype.getSprite = function() {
    return this.sprite;
  };

  return Tank;

})();

moduletank.FPS = (function() {

  function FPS() {
    var _this = this;
    this.label = new aphid.g2d.LabelTTF("??.??");
    this.label.position = new aphid.core.Point(100, 100);
    this.fpsCount = 0;
    this.lastTime = Date.now();
    this.label.scheduleUpdate();
    this.label.onframeupdate = function(target, frameInterval) {
      var interval;
      _this.fpsCount++;
      interval = Date.now() - _this.lastTime;
      if (interval > 5000) {
        _this.label.text = "" + (_this.fpsCount / interval * 1000).toFixed(2);
        _this.fpsCount = 0;
        return _this.lastTime = Date.now();
      }
    };
  }

  FPS.prototype.getLabel = function() {
    return this.label;
  };

  return FPS;

})();

moduletank.initialize = function() {
  var action, animation, background, director, fps, frames, i, imgSize, scene, tank, texture, _i, _ref;
  director = aphid.g2d.director;
  scene = new aphid.g2d.Scene();
  background = new aphid.g2d.Sprite(new aphid.g2d.Texture2D("background.png"));
  scene.addChild(background);
  texture = new aphid.g2d.Texture2D("tank.png");
  imgSize = texture.contentSize;
  frames = (function() {
    var _i, _results;
    _results = [];
    for (i = _i = 0; _i <= 4; i = ++_i) {
      _results.push(new aphid.g2d.SpriteFrame(texture, new aphid.core.Rect(imgSize.width * i / 5, 0, imgSize.width / 5, imgSize.height)));
    }
    return _results;
  })();
  animation = new aphid.g2d.Animation(frames, 0.05);
  action = aphid.g2d.actions.repeatForever(aphid.g2d.actions.animate(animation, false));
  for (i = _i = 1, _ref = moduletank.maxTankCount; 1 <= _ref ? _i <= _ref : _i >= _ref; i = 1 <= _ref ? ++_i : --_i) {
    tank = new moduletank.Tank(frames[0].texture);
    tank.getSprite().runAction(action.copy());
    scene.addChild(tank.getSprite());
  }
  fps = new moduletank.FPS();
  scene.addChild(fps.getLabel());
  return director.runScene(scene);
};

aphid.js.onload = moduletank.initialize;
